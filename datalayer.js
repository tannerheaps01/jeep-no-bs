"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var a=0,t=Array(e.length);a<e.length;a++)t[a]=e[a];return t}return Array.from(e)}function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var i=a[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(a,t,i){return t&&e(a.prototype,t),i&&e(a,i),a}}(),DATALAYER=function(){function e(){var a=this,t=arguments;_classCallCheck(this,e),this._getValue=function(e){var i=void 0;if("string"==typeof e)i=a._pageInfo[e];else{if(t.length)return void a._log((void 0===e?"undefined":_typeof(e))+" type not allowed!");i=a._pageInfo}return i},this._setValue=function(e,t){return"object"!==(void 0===e?"undefined":_typeof(e))?(a._log("Please use object to set new app/pageType/pageName e.g. {'key':'value', and so on...}"),!1):(Object.keys(e).forEach(function(t){"component"===t?window.digitalData.page.component&&"object"===_typeof(e[t])?a._extendObject(window.digitalData.page.component,e[t]):a._log("Please use object to set component values in digitalData. e.g.: component: {key: value}"):e[t]&&(a._pageInfo[t]=e[t])}),a._setDigitalDataVariable.init(a._pageInfo),t&&"function"==typeof t&&t(),window.digitalData)},this._setDigitalDataVariable={init:function(e){var t=a._setDigitalDataVariable,i=window.digitalData&&window.digitalData.page.component?window.digitalData.page.component:{};window.digitalData={page:{pageInfo:{pageName:e.brand+":"+e.country+t._getPageName(e),geoRegion:"brand:"+e.brand+":"+e.country+":tier1",language:e.language,version:e.cmsVersion,pageTemplate:e.pageTemplate,pageVersion:e.pageVersion,device:a._detectDevice(),responsiveState:a._getResponsiveState(),vehicleBrand:e.brand,vehicleModel:a._formatString(e.vehicle),vehicleMediaCode:e.vehicleFamilyCode,vehicleTrim:"",vehicleModelYear:a._formatString(e.year),vehicleDesc:t._getVehicleDesc(),zipCode:a._getCookie("zipcode"),errorCode:t._getErrorCode(e)},category:{primaryCategory:e.brand+":"+e.country+t._subCategoryData1(e),subCategory1:e.brand+":"+e.country+t._subCategoryData1(e),subCategory2:e.brand+":"+e.country+t._subCategoryData2(e),pageType:t._getPageType(e)},component:i}}},_getPrimaryCategory:function(e){return e.pageType?":"+e.pageType:""},_getPageName:function(e){return"vehiclepage"===e.pageType||"limited-editions"===e.pageType||"reveal"===e.pageType||"post-reveal"===e.pageType?e.vehicle?":"+e.year+":"+e.vehicle+":"+e.pageName:":"+e.pageType+":"+e.pageName:"homepage"===e.pageType?":"+e.pageType:"compare"===e.pageType?":"+e.pageName:""!==e.pageName?":"+(e.pageType?e.pageType+":"+e.pageName:e.pageName):":"+e.pageType},_subCategoryData1:function(e){return"shopping-tools"===e.pageType?":"+e.pageType+":"+e.pageName.split(":")[0]:"vehiclepage"===e.pageType&&"vehicle-selector"!==e.pageName?":"+e.year+":"+e.vehicle:"vehiclepage"===e.pageType&&e.trim.length>0&&(""===e.pageName||"landing"===e.pageName)?":"+e.year+":"+e.vehicle:"lifestyle"===e.pageType&&"renegade-life"===e.pageName.split(":")[0]?":"+e.pageType+":renegade-life":"compare"===e.pageType?e.vehicle?":"+e.vehicle:"":""!==e.pageName?":"+(e.pageType?e.pageType+":"+e.pageName:e.pageName):":"+e.pageType},_subCategoryData2:function(e){var a=void 0;return"shopping-tools"===e.pageType?a=":"+e.pageType+":"+e.pageName:"vehiclepage"===e.pageType?"vehicle-selector"!==e.pageName?a=":"+e.year+":"+e.vehicle+":"+e.pageName:""!==e.pageName&&(a=":"+(e.pageType?e.pageType+":"+e.pageName:e.pageName)):a="compare"===e.pageType?":"+e.pageName:""!==e.pageName?":"+(e.pageType?e.pageType+":"+e.pageName:e.pageName):":"+e.pageType,a},_getLinkLocation:function(e){return a._setDigitalDataVariable._subCategoryData2(e).replace(e.country+":","").replace(":","")},_getPageType:function(e){var a=void 0;return"vehicle-selector"===e.pageName?a=e.pageName:"shopping-tools"===e.pageType?e.pageName.indexOf(":vehicle-selector")>-1?a=e.pageName.split(":")[1]:-1===e.pageName.indexOf(":vehicle-selector")&&(a=e.pageName.split(":")[0]):"vehiclepage"===e.pageType?"landing"===e.pageName?""!==e.trim&&""!==e.vehicle?a="mlp":""===e.trim&&""!==e.vehicle&&(a="vlp"):a=e.pageName.split(":")[0]:a=e.pageType,a},_getVehicleDesc:function(){var e="",t=window.sdp;return a._pageInfo.brand&&a._pageInfo.vehicle&&a._pageInfo.year&&(e+=a._pageInfo.brand+"|"+a._pageInfo.year+"|"+a._pageInfo.vehicle),t.context.get("color")&&(e+="|"+t.context.get("color")),t.context.get("engine")&&(e+="|"+t.context.get("engine")),t.context.get("transmission")&&(e+="|"+t.context.get("transmission")),e},_getErrorCode:function(e){var a="";return"error-page"===e.pageType&&(a=404),a}},this._buildTTString=function(e){var t=location.protocol+"//"+location.hostname+"/?",i=window._satellite.getVar("totalTagParams");void 0!==i&&(i=i.replace(/prop25=[^&]+&/i,"prop25="+e+"&"),a._log("totalTag: "+t+i),"function"==typeof window.totaltag&&window.totaltag(t+i))},this._getAdobeVars=function(e){var t=e;if(t.getAttribute&&(t.getAttribute("data-donottrack")||t.getAttribute("data-stoptrack")))return!0;var i={},n="",r="",o="nav",p="click",g=null,s=null,d="",l="",c="";if(n=a._formatString(t.getAttribute("data-lid")),r=a._formatString(t.getAttribute("data-lpos")),t.getAttribute("data-action-type")&&(p=t.getAttribute("data-action-type")),t.getAttribute("data-adobe-events")&&(d+=t.getAttribute("data-adobe-events")),t.getAttribute("data-adobe-linktype")&&(o=t.getAttribute("data-adobe-linktype")),i={lid:n,lpos:r,linkType:o,events:d,actionType:p,vars:{},mediaEvents:[]},t.getAttribute("data-brand-event")&&a._getMediaEvent("brand")&&(l=t.getAttribute("data-brand-event"),i.mediaEvents.push({name:l,value:a._getMediaEvent("brand")})),t.getAttribute("data-vehicle-event")&&a._getMediaEvent("vehicle")&&(c=t.getAttribute("data-vehicle-event"),i.mediaEvents.push({name:c,value:a._getMediaEvent("vehicle")})),t.getAttribute("data-adobe-evars")&&(g=JSON.parse(t.getAttribute("data-adobe-evars"))),t.getAttribute("data-adobe-props")&&(s=JSON.parse(t.getAttribute("data-adobe-props"))),((!g||!g.eVar5)&&(!s||!s.prop1)||(!g||!g.eVar48)&&(!s||!s.prop48))&&t.getAttribute("data-context")){var u=JSON.parse(t.getAttribute("data-context"));g={},s={},g.eVar47=s.prop47=a._pageInfo.brand,g.eVar5=s.prop1=u.vehicle+(u.trim?":"+u.trim:""),g.eVar48=s.prop48=u.year}return null!==g&&a._extendObject(i.vars,g),null!==s&&a._extendObject(i.vars,s),a._linkTrack(t,i),!1},this._linkTrack=function(e,t){if(!window.s)return!1;e&&e.getAttribute&&e.getAttribute("href")&&!(0===e.getAttribute("href").indexOf("#")&&e.getAttribute("href").indexOf("#app-")<0)||(e=!0);var i=t.actionType||"click",n=window.s,r=a._formatString(t.lpos+"|"+t.lid),o=t.linkType||"nav";n.linkTrackEvents="None",n.linkTrackVars="None";var p=a._buildEvarsProps(t.vars||{},o,r),g=p.adobeLinkType,s=p.pev2Name;if(a._buildEvents(t.events||"",t.mediaEvents||"",o,i),n.tl(e,g,s),t.mediaEvents){a._buildTTString(r);var d="http://"+location.hostname+"/?",l=window._satellite.getVar("totalTagParams");void 0!==l&&(l=l.replace(/prop25=[^&]+&/i,"prop25="+t.lid+"&"),a._log("totalTag: "+d+l))}return!0},this.media={mediaEnd:!1,mediaData:{},getMedia:function(){var e=document.querySelectorAll("video, audio");Array.prototype.forEach.call(e,function(e,t){if(e.hasAttribute("data-donottrack"))return!1;e.getAttribute("data-tracking-id")||e.setAttribute("data-tracking-id",""+e.tagName+t),a.media.setEvents(e)})},setEvents:function(e){var t=e.getAttribute("data-tracking-id");a.media.mediaData[t]={mediaEnd:!1},e.addEventListener("play",a.media.onPlayerStateChange),e.addEventListener("pause",a.media.onPlayerStateChange),e.addEventListener("paused",a.media.onPlayerStateChange),e.addEventListener("seeked",a.media.onPlayerStateChange),e.addEventListener("ended",a.media.onPlayerStateChange)},stopVideoTrack:function(e){e.removeEventListener("play",a.media.onPlayerStateChange),e.removeEventListener("pause",a.media.onPlayerStateChange),e.removeEventListener("paused",a.media.onPlayerStateChange),e.removeEventListener("seeked",a.media.onPlayerStateChange),e.removeEventListener("ended",a.media.onPlayerStateChange)},onPlayerStateChange:function(e){if(!window.s)return!1;var t=window.s,i=e.target.getAttribute("data-tracking-id");return"play"===e.type&&(0===Math.floor(e.target.currentTime)||a.media.mediaData[i].mediaEnd?(t.Media.open(i,e.target.duration,"My Media Player"),t.Media.play(i,e.target.currentTime)):t.Media.play(i,e.target.currentTime),a.media.mediaData[i].mediaEnd=!1),"pause"===e.type&&t.Media.stop(i,e.target.currentTime),"seeked"===e.type&&(0===e.target.currentTime||a.media.mediaData[i].mediaEnd||(t.Media.play(i,e.target.currentTime),t.Media.stop(i,e.target.currentTime))),"ended"===e.type&&(a.media.mediaData[i].mediaEnd=!0,t.Media.stop(i,e.target.duration)),!0},init:function(){a.media.getMedia()}},this._clickTrack=function(e){a._getAdobeVars(e)},this._init=function(){var e=a;a._log("Adobe analytics initialized, use DATALAYER to set/get page info, or fire pageTrack or linkTrack"),a._setDigitalDataVariable.init(a._setPageInfo()),document.addEventListener("DOMContentLoaded",function(){e._initClickTracks(),e.media.init()})};var i=document.location,n=i.hostname,r=n.split(".")[0].toLowerCase(),o=n.indexOf("es.")>=0||n.indexOf("es-")>=0?"es":"en";this._pageInfo={environment:r,cmsVersion:"aem 6.1",language:o,brand:"",brandID:"",country:"us",pageType:"pageType",pageName:"pageName",pageTemplate:"",pageVersion:"",vehicle:"",trim:"",year:""},this._trackingVariables=[],window.DATALAYER={pageInfo:this._pageInfo,formatString:this._formatString,init:this._init,detectDevice:this._detectDevice,getResponsiveState:this._getResponsiveState,set:this._setValue,get:this._getValue,buildTTString:this._buildTTString,pageTrack:this._pageTrack,linkTrack:this._linkTrack,getMediaEvent:this._getMediaEvent,media:{init:this.media.init,track:this.media.setEvents,removeTrack:this.media.stopVideoTrack}}}return _createClass(e,[{key:"_log",value:function(e){return void 0!==window.console&&void 0!==window.console.log&&window.debug&&console.debug(e),!1}},{key:"_formatString",value:function(e){var a=void 0;return"string"==typeof e&&(a=e.toLowerCase().replace(/^ +/gm,"").replace(/ +$/gm,"").replace(/\<[^\>]*\>/g,"").replace(/(\s|_)+/g,"-").replace("&ntilde;","n").replace(/&amp;|&/g,"and").replace(/-{2,}/g,"-").replace(/\//g,":").replace(/:{2,}/g,":").replace(/[:-]+$/g,"").replace(":en:",":us:").replace(/[^a-z0-9|:-]/gi,"")),a}},{key:"_getCookie",value:function(e){var a=e;return window.sdp.cookie.get(a)}},{key:"_extendObject",value:function(e,a){for(var t in a)a[t]&&(e[t]=a[t])}},{key:"_detectDevice",value:function(){var e=window.screen.width;switch(!0){case e>=1005:return"desktop";case e>=700:return"tablet";case e>=510:return"phablet";default:return"mobile"}}},{key:"_getResponsiveState",value:function(){var e=window.innerWidth||"";switch(!0){case e>=1005:return"desktop";case e>=700:return"tablet";case e>=510:return"phablet";default:return"mobile"}}},{key:"_getMediaEvent",value:function(e){var a=window._satellite.getVar("serial_key");return a+="vehicle"===e?window._satellite.getVar("vehicleMediaCode"):window._satellite.getVar("brandMediaCode")}},{key:"_storeVariablesForTracking",value:function(){var e=["(pageName)","(server)","(channel)","(prop\\d+)","(eVar\\d+)","(list)"],a=new RegExp("\\b"+e.join("\\b|\\b")+"\\b"),t=[],i=["eVar28","prop30"];return Object.keys(s).forEach(function(e){s[e]&&a.test(e)&&!i.includes(e)&&t.push(e)}),this._trackingVariables=t,t}},{key:"_setPageInfo",value:function(){var e=this,a=void 0!==window.sdp&&window.sdp.context.get()?window.sdp.context.get():{};Object.keys(this._pageInfo).forEach(function(t){void 0===a[t]&&""!==a[t]||(e._pageInfo[t]=e._formatString(a[t]))}),"fiatusa"===this._pageInfo.brand&&(this._pageInfo.brand="fiat");try{a.vehicle&&(this._pageInfo.vehicle=this._formatString(a.vehicle+(a.trim?":"+a.trim:"")),this._pageInfo.year=a.year,this._pageInfo.vehicleFamilyCode=Helpers.getFamilyCode({vehicle:a.vehicle}))}catch(e){this._log(e)}return window.DATALAYER.pageInfo=this._pageInfo,this._pageInfo}},{key:"_pageTrack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=e;window._satellite&&window.s&&(window.s.clearVars("events"),window.s.clearVars("eVars"),window.s.clearVars("props"),"string"==typeof a&&""!==a?window._satellite.track(a):window.s.t(a))}},{key:"_buildEvarsProps",value:function(e,a,t){var i=this,n=[],r=window.s,o=0!==this._trackingVariables.length?this._trackingVariables:this._storeVariablesForTracking(),p=this._setDigitalDataVariable._getLinkLocation(this._pageInfo),g="o";switch(n.push("events"),e.eVar53=e.prop53=this._getResponsiveState(),e.eVar28="feature"===r.eVar25?this._pageInfo.pageName:e.eVar28,e.prop48=e.eVar48=e.eVar48?e.eVar48:e.prop48?e.prop48:this._pageInfo.year,e.prop1=e.eVar5=e.eVar5?e.eVar5:e.prop1?e.prop1:r.eVar5?r.eVar5:r.prop1?r.prop1:this._pageInfo.vehicle,e.eVar63="",a){case"nav":e.eVar75=this._pageInfo.brand+"|"+a+"|"+p+"|"+t;break;case"exit":g="e",e.eVar75=this._pageInfo.brand+"|nav|"+p+"|"+t;break;case"download":g="d",e.eVar75=this._pageInfo.brand+"|func|"+p+"|"+t;break;case"cta":e.eVar75=this._pageInfo.brand+"|"+a+"|"+p+"|"+t,e.eVar23=e.eVar75;break;case"func":case"tool":e.eVar75=this._pageInfo.brand+"|"+a+"|"+p+"|"+t;break;case"promo":e.eVar75=this._pageInfo.brand+"|"+a+"|"+p+"|"+t,e.eVar22=e.eVar75;break;case"social":e.eVar75=this._pageInfo.brand+"|"+a+"|"+p+"|"+t,g="e";break;case"hero":e.eVar75=this._pageInfo.brand+"|"+a+"|"+p+"|"+t.replace(":","|"),e.eVar22=e.eVar75;break;case"vehicle":e.eVar28=t.substring(0,t.indexOf("|")),e.eVar75=this._pageInfo.brand+"|nav|"+p+"|"+t}return e.prop9=e.eVar75,n.push.apply(n,_toConsumableArray(o)),Object.keys(e).forEach(function(a){n.push(a),r[a]=i._formatString(e[a])}),r.linkTrackVars=n.join(","),{adobeLinkType:g,pev2Name:e.eVar75}}},{key:"_buildEvents",value:function(e,a,t,i){var n=e,r="";switch(-1===n.indexOf("event70")&&(n.length&&(n+=","),n+="event70"),-1===n.indexOf("event54")&&-1===n.indexOf("event55")&&-1===n.indexOf("event56")&&(n+="hover"===i?",event55":"swipe"===i?",event56":",event54"),"vlp"===this._pageInfo.pageType&&(n+="event33"),t){case"nav":case"exit":case"download":break;case"cta":n+=",event69";break;case"func":case"tool":break;case"promo":n+=",event68";break;case"social":n+=-1===n.indexOf("event30")?",event30":"";break;case"hero":n+=",event68";break;case"vehicle":n+=",event33"}r=n,a&&a.forEach(function(e){var a=e.name,t=a+":"+e.value;r+=","+a,n+=","+t}),window.s.linkTrackEvents=r,window.s.events=n}},{key:"_initClickTracks",value:function(){var e=this;document.addEventListener("click",function(a){var t=a.target;if(t&&t.classList&&t.classList.contains("bubble-number"))return!1;if("A"===t.tagName&&t.getAttribute&&t.getAttribute("data-lpos")&&t.getAttribute("data-lid"))e._clickTrack(t);else{for(;t&&t.getAttribute&&("A"!==t.tagName||!t.getAttribute("data-lpos")||!t.getAttribute("data-lid"));)t=t.parentNode;t&&"A"===t.tagName&&t.getAttribute&&t.getAttribute("data-lpos")&&t.getAttribute("data-lid")&&e._clickTrack(t)}},!1)}}]),e}();new window.DATALAYER,window.DATALAYER.init();
